// -- user code here --
import Ball from './prefabs/Ball';
import Paddle from './prefabs/Paddle';
import Back from './prefabs/Back';
import Heart from './prefabs/Heart';
import Hold from './prefabs/Hold';
import BallTool from './prefabs/BallTool';
import MuteBtn from './prefabs/MuteBtn';
import Restart from './prefabs/Restart';

import Facade from '../../src/puremvc/core/patterns/facade/Facade';
/* --- start generated code --- */

// Generated by Phaser Editor 1.4.3 (Phaser v2.6.2)


class SinglePlayer extends Phaser.State {
	
	/**
	 * SinglePlayer.
	 */
	constructor() {
		
		super();
		
	}
	
	init() {
		
		this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
		
	}
	
	preload () {
		
		this.load.pack('preloader', 'assets/pack.json');
		
	}
	
	create() {
		
		this.fStarfield = this.add.tileSprite(0, 0, this.game.width, this.game.height, 'starfield', null);
		
		var _main = this.add.group();
		
		var _holds = this.add.group(_main);
		
		var _hold_down = new Hold(this.game, 99, 379);
		_holds.add(_hold_down);
		
		var _paddles = this.add.group(_main);
		
		var _paddle_down = new Paddle(this.game, _paddles, 'paddle_down', undefined, true, Phaser.Physics.ARCADE);
		_paddle_down.position.setTo(125, 414);
		
		var _ball = new Ball(this.game, 128, 361);
		_main.add(_ball);
		
		var _restart = new Restart(this.game, 147, 136);
		_main.add(_restart);
		
		var _hearts = this.add.group();
		
		var _heart_down = new Heart(this.game, 304, 440);
		_hearts.add(_heart_down);
		
		var _backs = this.add.group();
		
		var _back_down = new Back(this.game, 0, 431);
		_backs.add(_back_down);
		
		var _texts = this.add.group();
		
		var _info_down = this.add.text(59, 193, 'infoText', {"font":"bold 30px Arial","fill":"#ffffff","stroke":"#ffffff"}, _texts);
		
		var _mute = new MuteBtn(this.game, 291, 12);
		this.add.existing(_mute);
		
		var _score_text = this.add.text(10, 10, 'scoreText', {"font":"bold 20px Arial","fill":"#ffffff","stroke":"#ffffff"});
		
		var _introText = this.add.text(16, 226, '- hold the paddle, then release to start -', {"font":"bold 16px Arial","fill":"#ffffff"});
		
		var _ballTool = new BallTool(this.game);
		_ballTool.position.setTo(97, 424);
		
		
		
		// public fields
		
		this.fMain = _main;
		this.fHolds = _holds;
		this.fHold_down = _hold_down;
		this.fPaddle_down = _paddle_down;
		this.fBall = _ball;
		this.fRestart = _restart;
		this.fHeart_down = _heart_down;
		this.fBack_down = _back_down;
		this.fInfo_down = _info_down;
		this.fMute = _mute;
		this.fScore_text = _score_text;
		this.fIntroText = _introText;
		this.fBallTool = _ballTool;
		// user code
		this.initObjects();
		Facade.getInstance('Game').sendNotification('GAME_SCENE_CHANGED');
		
	}
	
	/* state-methods-begin */
	// -- user code here --
	initObjects() {
		var paddingHeight = -10;
		var paddingWidth = -10;
		
		this.fHold_down.width = this.fPaddle_down.width;
		this.fHold_down.alignIn(this.game.world.bounds, Phaser.BOTTOM_CENTER, 0, paddingHeight * 2);
		
		this.fHeart_down.alignIn(this.game.world.bounds, Phaser.BOTTOM_RIGHT, paddingWidth, paddingHeight);
		
		this.fBack_down.alignIn(this.game.world.bounds, Phaser.BOTTOM_LEFT, paddingWidth, paddingHeight);

		this.fBallTool.alignIn(this.game.world.bounds, Phaser.BOTTOM_CENTER, 0, paddingHeight);
		this.fBallTool.paddingHeight = paddingHeight;
		
		this.fInfo_down.alignIn(this.game.world.bounds, Phaser.CENTER);
		
		this.fIntroText.alignIn(this.game.world.bounds, Phaser.CENTER);
		
		this.fRestart.alignTo(this.fIntroText, Phaser.BOTTOM_CENTER, 0, 30);
		
		var mask = this.game.add.graphics(0, 0);
		mask.beginFill(0xffffff);
		mask.drawRect(0, 0, this.game.width, this.game.height - 50);
		this.fMain.mask = mask;
		this.fStarfield.mask = mask;
	}

	// TODO:
	// 再看看有沒有辦法用 .bind 的方式把 shutdown() 搬進場景的 Mediator 中
	shutdown() {
		Facade.getInstance('Game').sendNotification('GAME_SCENE_SHUTDOWN');
	}
	/* state-methods-end */
	
}
/* --- end generated code --- */
// -- user code here --
export default SinglePlayer;